{% extends 'webapp/base.html' %}

{% block one %}
<div style="margin-left: 15px; margin-top: 7px; margin-bottom: -50  px;"><strong>Legend:</strong>
  <p><img src="http://maps.google.com/mapfiles/ms/icons/green-dot.png"> Safe Location &nbsp; <img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png"> Danger Location </p>
</div>
{%  endblock %}

{% block two %}
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDv2lJm1ggUG25OhwdEtz_GYbWW8qwEK4U&callback=initMap">
</script>
<script>
    // Initialize and add the map
    function initMap() {
    // Try HTML5 geolocation.
    var infoWindow = new google.maps.InfoWindow;
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
        };
        var map = new google.maps.Map(
        document.getElementById('map'), {zoom: 15, center: pos});
        var currentMarker = new google.maps.Marker({position: pos, map:map, icon:{
            url:'http://www.robotwoods.com/dev/misc/bluecircle.png'
        }});
        fetch('http://hackverse-gods.herokuapp.com/get_all_safe_locations')
        .then((response) => {
          return response.json();
        })
        .then((myJson) => {
          for(var i=0;i<myJson.length;i++){
        var safe_loc = {lat: myJson[i].latitude, lng:myJson[i].longitude} 
        var safe_loc_marker = new google.maps.Marker({position: safe_loc, map: map, icon: {
            url:'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
    }})}
        });
        fetch('http://hackverse-gods.herokuapp.com/get_all_distress_locations')
        .then((response) => {
          return response.json();
        })
        .then((myJson) => {
          for(var i=0;i<myJson.length;i++){
        var distress_loc = {lat: myJson[i].latitude, lng:myJson[i].longitude}
        var distress_loc_marker = new google.maps.Marker({position: distress_loc, map: map, icon: {
            url:'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
    }})}})
        // infoWindow.setPosition(pos);
        // infoWindow.setContent('Location found.');
        // infoWindow.open(map);
        map.setCenter(pos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
    }

    
  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
                          'Error: The Geolocation service failed.' :
                          'Error: Your browser doesn\'t support geolocation.');
    infoWindow.open(map);
  }
</script>
{% endblock %}